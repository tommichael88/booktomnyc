
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BookTOM</title>
  <meta name="description" content="" />
  <meta property="og:title" content="Tom Kongerslev" />
  <meta property="og:type" content="website" />
  <meta property="og:description" content="BookTom" />
  <meta property="og:image" content="https://github.com/tommichael88/booktomnyc/blob/main/images/___test.png?raw=true" />
  <meta name="referrer" content="strict-origin-when-cross-origin" />
  <meta http-equiv="X-XSS-Protection" content="1; mode=block" />
  <link id="favicon" rel="icon" href="https://github.com/tommichael88/booktomnyc/blob/main/images/___test.png?raw=true" type="image/x-icon" />
  <link rel="preload" href="https://tommichael88.github.io/booktomnyc/images/TomsHandyTech_logo_today_lowres_nobg.png?raw=true" as="image" />
  <link rel="preload" href="https://tommichael88.github.io/booktomnyc/images/TomKongerslev_nobg.png?raw=true" as="image" />
  <link rel="preload" href="https://tommichael88.github.io/booktomnyc/js/marquee.js" as="script" />
  <link rel="shortcut icon" href="https://github.com/tommichael88/booktomnyc/blob/main/images/___test.png?raw=true" type="image/x-icon" />
  <link rel="apple-touch-icon" href="https://github.com/tommichael88/booktomnyc/blob/main/images/___test.png?raw=true" />
  <link rel="stylesheet" href="https://tommichael88.github.io/booktomnyc/External/styles.css" />

    <style>
        /* ========== CORE ELEMENTS & VARIABLES ========== */
        :root {
            --bg-card: #1e1e1e;
            --bg-card-hover: #2a2a2a;
            --primary: #474747;
            --primary-hover: #ffffff;
            --text-primary: #f5f5f5;
            --text-secondary: #c0c0c0;
            --accent-light: rgba(250, 0, 0, 1);
            --accent: rgba(250, 0, 0, 1);
            --selected-bg: rgba(250, 0, 0, 0.1);
            --border-radius: 12px;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.2);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Ubuntu', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        html {
            scroll-behavior: smooth;
            -webkit-text-size-adjust: 100%;
        }

        html,
        body {
            min-height: 100vh;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        body {
            padding: 10px;
            margin: auto;
            max-width: 468px;
            position: relative;
        }

        /* ========== PAGE BACKGROUND & LAYOUT ========== */
        .pg_background {
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: -1;
            background-image: url('https://github.com/tommichael88/booktomnyc/blob/main/images/tomshandybgmodern.jpg?raw=true');
        }

        .qrc_page_wrapper {
            background-size: cover;
            background-position: inherit;
            background-color: var(--qrc-secondary);
            max-width: auto;
            padding: 0;
            padding-top: 0.1px;
            padding-bottom: 0.1px;
            overflow: auto;
            position: relative;
            height: 100vh;
        }

        .qrc_page_inner {
            max-width: 490px;
            margin: auto;
            position: relative;
            padding: 4px 4px 1px 4px;
            border-radius: var(--border-radius);
            padding-bottom: 90px;
            z-index: 9;
        }

        /* ========== HEADER & PROFILE ELEMENTS ========== */
        .header {
            display: flex;
            background: rgba(168, 168, 168, .65);
            padding: 12px;
            border-radius: var(--border-radius);
            margin: 10px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-md);
        }

        .header h1 {
            font-size: 1.1rem;
            font-weight: 800;
            background: linear-gradient(225deg, #000 10%, #de0000 60%, #de0000 70%, #8a0615 60%, #de0000 95%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: inline-block;
            position: relative;
            letter-spacing: -0.5px;
        }

        .header h1::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 50%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 3px;
        }

        .profile-image {
            display: block;
            width: 100%;
            height: auto;
            border-radius: var(--border-radius);
            margin: 2px auto;
            box-sizing: border-box;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
        }

        .profile-image:hover {
            transform: scale(1.01);
        }

        .highlight-box {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 15px;
            gap: 2%;
            background: rgba(169, 169, 169, .5);
                        backdrop-filter: blur(10px);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(169, 169, 169, 0.9);
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .highlight-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .thandylogo {
            max-height: 4rem;
            width: auto;
            flex: 0 0 auto;
            object-fit: contain;
            box-shadow: var(--shadow-md);
            z-index: 1;
            transition: var(--transition);
        }

        .tom_kongerslev {
            flex: 1 1 auto;
            min-width: 0;
            margin: auto;
            position: relative;
            z-index: 1;
            object-fit: contain;
        }

        .tom_kongerslev img {
            max-height: relative;
            width: auto;
            max-width: 100%;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        /* ========== CONTACT TOOLBAR ========== */
        .contact-button {
            padding: 8px 12px;
            font-size: 0.85rem;
            font-weight: 700;
            background: #C0C0C0;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: #2a2a2a;
            cursor: pointer;
            transition: var(--transition);
        }

        .contact-button:hover {
            transform: scale(1.2) rotate(5deg);
            text-shadow: 0 0 12px rgba(222, 222, 222, 0.8), 0 0 20px rgba(222, 222, 222, 0.4), 0 0 30px rgba(222, 222, 222, 0.2);
            color: #FFF;

        }

        .contact-toolbar {
            display: none;
            background: rgba(169, 169, 169, .5);
                        backdrop-filter: blur(10px);
            border: 2px outset rgba(169, 169, 169, 0.8);
            border-radius: var(--border-radius);
            padding: 12px 8px;
            margin: 0 auto;
            justify-content: space-around;
            align-items: center;
            box-shadow: var(--shadow-lg);
            animation: slideDown 0.3s ease;
            width: 100%;
            max-width: 460px;
        }

        .contact-toolbar.active {
            display: flex;
        }

        .contact-toolbar-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px 12px;
            border-radius: 10px;
            transition: var(--transition);
            cursor: pointer;
            text-decoration: none; 
            font-weight: 700;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(169, 169, 169, 0.2);
            color: #FFF;
            min-width: 70px;
            position: relative;
            overflow: hidden;
        }

        .contact-toolbar-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 0, 0, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .contact-toolbar-item:hover::before {
            left: 100%;
        }

        .contact-toolbar-item:hover {
            background: radial-gradient(circle at 10% 60%, #c0c0c0 0%, #FFF 40%, #FFF 60%, #c0c0c0 90%);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 20px rgba(250, 250, 250, 0.3);
            border-color: rgba(0, 0, 0, 0.6);
            color: #ffffff;
        }

        .contact-toolbar-icon {
            font-size: 1.8rem;
            margin-bottom: 6px;
            background: radial-gradient(circle at 10% 60%, #c0c0c0 0%, #FFF 40%, #FFF 60%, #c0c0c0 90%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5), 1px 1px 0 rgba(255, 255, 255, 0.1);
            transition: var(--transition);
            filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.3));
        }

        .contact-toolbar-item:hover .contact-toolbar-icon {
            transform: scale(1.2) rotate(5deg);
            text-shadow: 0 0 12px rgba(222, 222, 222, 0.8), 0 0 20px rgba(222, 222, 222, 0.4), 0 0 30px rgba(222, 222, 222, 0.2);
        }

        .contact-toolbar-label {
            font-size: 0.75rem;
            font-weight: 700;
            text-align: center;
            text-shadow: 1px 2px 4px rgba(0, 0, 0, 0.9);
            color: #2a2a2a;
            transition: var(--transition);
        }

        .contact-toolbar-item:hover .contact-toolbar-label {
            color: #ffffff;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
        }

        /* ========== SERVICE SCHEDULE CARD ========== */
        .card-schedule-service {
            display: block;
            border: 1px outset rgba(0, 0, 0, .75);
            background: rgba(255, 255, 255, 1);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            text-align: center;
            padding: 20px;
            margin: 15px auto;
            overflow: hidden;
            box-sizing: border-box;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
        }

        .card-schedule-service:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .new-service-request-grid-topper {
            display: flex;
            font-size: 1rem;
            padding: 12px 16px;
            border: 2px inset rgba(169, 169, 169, .1);
            color: #2a2a2a;
            justify-content: space-between;
            align-items: center;
            text-align: center;
            font-weight: 700;
            object-fit: contain;
            background: linear-gradient(25deg, #f8f8f8 1%, #e8e8e8 20%, #f0f0f0 40%, #e8e8e8 60%, #f8f8f8 95%);
            border-radius: 10px;
            transition: var(--transition);
            cursor: pointer;
        }

        .new-service-request-grid-topper:hover {
            background: linear-gradient(25deg, #ffffff 1%, #f0f0f0 20%, #f8f8f8 40%, #f0f0f0 60%, #ffffff 95%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .reschedule-service-button {
            font-weight: 700;
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            color: #2a2a2a;
            border: 1px solid rgba(169, 169, 169, 0.3);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: .75rem;
            cursor: pointer;
            object-fit: contain;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .reschedule-service-button:hover {
            background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* ========== CATEGORIES GRID ========== */
        .menu-container {
            display: grid;
            place-items: center;
            padding: 0;
            margin: 0;
            width: 100%;
        }

        #categories-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            max-width: 400px;
            margin: 15px auto;
            width: 100%;
        }

        .category-tile * {
            pointer-events: none;
        }

        .category-tile {
            background: rgba(255, 255, 255, 0.9);
            color: #2a2a2a;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(192, 192, 192, 0.5);
            padding: 15px 8px;
            width: 100%;
            aspect-ratio: 1 / 1 !important;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            box-sizing: border-box;
            transition: var(--transition);
            position: relative;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            cursor: pointer;
            user-select: none;
        }

        .category-tile::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(222, 0, 0, 0) 0%, rgba(222, 0, 0, 0.05) 100%);
            opacity: 0;
            transition: var(--transition);
        }

        .category-tile:hover::before {
            opacity: 1;
        }

        .category-tile h2 {
            font-size: 0.95rem;
            line-height: 1.3;
            margin: 0;
            padding: 0;
            word-break: break-word;
            font-weight: 700;
            position: relative;
            z-index: 1;
            transition: var(--transition);
        }

        .category-tile:active {
            transform: scale(0.95);
            transition: transform 0.1s ease;
        }

        .category-tile::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: 10px;
            width: 0;
            height: 3px;
            background: linear-gradient(25deg, #000 10%, #de0000 60%, #de0000 70%, #8a0615 60%, #de0000 95%);
            transition: var(--transition);
            transform: translateX(-50%);
        }

        .category-tile:hover::after {
            width: 70%;
        }

        .category-tile:hover h2 {
            text-shadow: 0 2px 8px rgba(222, 0, 0, 0.3);
            color: #de0000;
            transform: translateY(-2px);
        }

        .category-icon {
            font-size: 2.2rem;
            margin-bottom: 8px;
            background: linear-gradient(55deg, #000 10%, #de0000 60%, #de0000 70%, #8a0615 60%, #de0000 95%);
            -webkit-text-fill-color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
            position: relative;
            z-index: 1;
            filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.2));
        }

        .category-tile:hover {
            transform: translateY(-5px) scale(1.03);
            box-shadow: var(--shadow-lg);
            border-color: rgba(222, 0, 0, 0.3);
            background: rgba(255, 255, 255, 0.95);
        }

        .category-tile:hover .category-icon {
            transform: scale(1.15) rotate(5deg);
            filter: drop-shadow(0 3px 6px rgba(222, 0, 0, 0.3));
        }

        /* ========== FLOATING ACTION BUTTONS ========== */
        .fab-container {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 9999;
        }

        .fab {
            color: #FFF;
            font-weight: 700;
            background: linear-gradient(135deg, #de0000 0%, #8a0615 100%);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 12px 16px;
            outline: 0;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }

        .fab:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 8px 25px rgba(222, 0, 0, 0.4);
        }

        /* ========== INVOICE SYSTEM ========== */
        .invoice-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(12px);
            display: none;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .invoice-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(248, 248, 248, 0.95) 100%);
            color: #2a2a2a;
            border-radius: 16px;
            border: 2px solid rgba(169, 169, 169, 0.3);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 450px;
            position: relative;
            animation: invoiceSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .invoice-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), #8a0615, var(--accent));
            box-shadow: 0 2px 8px rgba(222, 0, 0, 0.4);
        }

        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 2px solid rgba(222, 0, 0, 0.1);
            background: rgba(255, 255, 255, 0.95);
        }

        .invoice-title {
            margin: 0;
            font-size: 1.3rem;
            font-weight: 800;
            color: #2a2a2a;
            text-align: center;
        }

        .close-btn {
            background: rgba(222, 0, 0, 0.1);
            border: 1px solid rgba(222, 0, 0, 0.3);
            border-radius: 8px;
            color: #2a2a2a;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            font-weight: bold;
        }

        .close-btn:hover {
            background: var(--accent);
            color: white;
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 4px 12px rgba(222, 0, 0, 0.4);
        }

        .service-list {
            padding: 1.5rem;
            flex: 1;
            overflow-y: auto;
            max-height: 400px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .invoice-service-item {
            display: grid;
            grid-template-columns: 60px 1fr auto auto;
            gap: 16px;
            align-items: center;
            padding: 18px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(250, 250, 250, 0.9) 100%);
            border: 1px solid rgba(169, 169, 169, 0.2);
            border-radius: 12px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .invoice-service-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(222, 0, 0, 0.05), transparent);
            transition: left 0.6s ease;
        }

        .invoice-service-item:hover::before {
            left: 100%;
        }

        .invoice-service-item:hover {
            border-color: rgba(222, 0, 0, 0.3);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .invoice-service-icon {
            font-size: 1.5rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, #2a2a2a 100%);
            border-radius: 12px;
            flex-shrink: 0;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
        }

        .invoice-service-item:hover .invoice-service-icon {
            transform: scale(1.05);
            background: linear-gradient(135deg, var(--accent) 0%, #8a0615 100%);
        }

        .invoice-service-text {
            flex: 1;
            min-width: 0;
        }

        .invoice-service-text h4 {
            margin: 0 0 6px 0;
            font-size: 1.1rem;
            font-weight: 800;
            color: #2a2a2a;
            line-height: 1.2;
        }

        .invoice-service-detail {
            font-size: 0.9rem;
            color: #666;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .invoice-service-notes {
            font-size: 0.8rem;
            color: #666;
            background: rgba(0, 0, 0, 0.03);
            padding: 8px 12px;
            border-radius: 8px;
            border-left: 3px solid var(--accent);
            line-height: 1.4;
            max-height: 60px;
            overflow-y: auto;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .invoice-service-price {
            font-size: 1rem;
            font-weight: 900;
            color: #2a2a2a;
            background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
            padding: 10px 14px;
            border-radius: 10px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            text-align: center;
            min-width: 100px;
        }

        .invoice-service-item:hover .invoice-service-price {
            background: linear-gradient(135deg, #de0000, #8a0615);
            color: white;
            transform: scale(1.05);
        }

        .invoice-remove-service-btn {
            background: rgba(222, 0, 0, 0.1);
            border: 1px solid rgba(222, 0, 0, 0.3);
            border-radius: 8px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            color: #2a2a2a;
            flex-shrink: 0;
        }

        .invoice-remove-service-btn:hover {
            background: var(--accent);
            color: white;
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 4px 12px rgba(222, 0, 0, 0.4);
        }

        .summary-section {
            padding: 1.5rem;
            border-top: 2px solid rgba(222, 0, 0, 0.1);
            background: rgba(255, 255, 255, 0.95);
        }

        .subtotal {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #2a2a2a 0%, #1e1e1e 100%);
            color: white;
            padding: 16px 20px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            border: 1px solid rgba(222, 0, 0, 0.3);
            box-shadow: var(--shadow-md);
        }

        #invoiceTotal {
            color: #ffffff;
            font-size: 1.3rem;
            font-weight: 900;
            background: linear-gradient(135deg, #de0000, #8a0615);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 8px rgba(222, 0, 0, 0.3);
        }

        .invoice-action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            padding: 1.5rem;
            margin: 0;
        }

        /* ========== SERVICE SELECTION & DETAILS ========== */
        #serviceRequestContainer,
        #servicedetailsContainer {
            display: flex;
            flex-direction: column;
            color: #2a2a2a;
            border: 2px solid rgba(169, 169, 169, 0.3);
            border-radius: 16px;
            padding: 12px;
            margin: 8px auto;
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(15px);
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.95);
            width: calc(100% - 4px);
        }

        #serviceRequestContainer {
            border-top: 4px solid var(--accent);
            background: rgba(255, 255, 255, 0.98);
        }

        .service-item-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            width: 100%;
            gap: 8px;
            box-sizing: border-box;
            padding: 0;
        }

        .service-item-card {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9) 0%, rgba(42, 42, 42, 0.9) 100%);
            color: white;
            padding: 0.6rem;
            border-radius: 10px;
            transition: var(--transition);
            cursor: pointer;
            box-sizing: border-box;
            width: 100%;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            text-align: center;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-sm);
        }

        .service-item-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(222, 0, 0, 0.2), transparent);
            transition: left 0.4s ease;
        }

        .service-item-card:hover::before {
            left: 100%;
        }

        .service-item-card:hover {
            background: linear-gradient(135deg, rgba(222, 0, 0, 0.9) 0%, rgba(138, 6, 21, 0.9) 100%);
            transform: translateY(-2px) scale(1.02);
            box-shadow: var(--shadow-md);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .service-item-card h4 {
            font-size: 0.85rem;
            margin: 0.3rem 0;
            line-height: 1.2;
            word-break: break-word;
            font-weight: 700;
            position: relative;
            z-index: 1;
            flex: 0 1 auto;
            max-width: 100%;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .service-item-card p {
            font-size: 0.65rem;
            color: #c0c0c0;
            margin: 0.2rem 0;
            line-height: 1.2;
            word-break: break-word;
            flex: 1 1 auto;
            position: relative;
            z-index: 1;
            max-width: 100%;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .service-price {
            font-weight: 800;
            font-size: 0.75rem;
            margin: 0.2rem 0;
            color: #FFF;
            background: linear-gradient(135deg, #de0000, #8a0615);
            padding: 0.3rem 0.5rem;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            flex-shrink: 0;
            position: relative;
            z-index: 1;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
            line-height: 1;
        }

        .service-item-icon {
            font-weight: 800;
            font-size: 1.6rem;
            margin-bottom: 0.2rem;
            filter: grayscale(100%) brightness(1.3) contrast(1.1);
            color: #f8f8f8;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            transition: var(--transition);
            position: relative;
            z-index: 1;
            flex-shrink: 0;
        }

        .service-item-card:hover .service-item-icon {
            filter: grayscale(0%) brightness(1.5) contrast(1.2);
            transform: scale(1.05) rotate(3deg);
        }

        /* ========== TASK DETAILS & OPTIONS ========== */
        .task-details {
            margin: 15px 0;
        }

        .radio-group {
            display: flex;
            gap: 15px;
            margin: 10px 0;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 0.8rem;
            padding: 1.2rem;
            background: rgba(166, 166, 166, 0.3);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            backdrop-filter: blur(10px);
            margin: 1rem 0;
        }

        .detail-card {
            background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 1rem 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.85rem;
            font-weight: 600;
            color: #333;
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
        }

        .detail-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(222, 0, 0, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .detail-card:hover::before {
            left: 100%;
        }

        .detail-card:hover {
            background: linear-gradient(135deg, #e8e8e8 0%, #d8d8d8 100%);
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
            border-color: var(--accent);
        }

        .detail-card.selected {
            background: linear-gradient(135deg, var(--accent) 0%, #8a0615 100%);
            color: white;
            border-color: var(--accent);
            box-shadow: 0 6px 20px rgba(250, 0, 0, 0.4);
            transform: scale(1.05);
        }

        .detail-card.selected::before {
            display: none;
        }

        .service-input-area {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            margin: 10px 0;
            resize: vertical;
        }

        /* ========== FURNITURE SELECTION ========== */
        .furniture-selection-section {
            margin: 15px 0;
        }

        .furniture-item-selection {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 10px 0;
        }

        .selected-furniture-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.8);
        }

        .selected-furniture-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            border-bottom: 1px solid #eee;
        }

        .remove-item {
            background: rgba(222, 0, 0, 0.1);
            border: 1px solid rgba(222, 0, 0, 0.3);
            border-radius: 5px;
            padding: 4px 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .remove-item:hover {
            background: var(--accent);
            color: white;
        }

        /* ========== SELECTED SERVICES SECTION ========== */
        #serviceRequestSection {
            display: none;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(248, 248, 248, 0.95) 100%);
            border: 2px solid rgba(169, 169, 169, 0.3);
            border-radius: 16px;
            padding: 20px;
            margin: 16px auto;
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(15px);
            transition: var(--transition);
            color: #2a2a2a;
        }

        .Requested-service-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(222, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .Requested-service-header h4 {
            font-size: 1.3rem;
            font-weight: 800;
            color: #2a2a2a;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #serviceRequestList {
            display: flex;
            flex-direction: column;
            gap: 16px;
            min-height: 120px;
            padding: 0;
            margin-bottom: 20px;
        }

        .requested-service-item {
            display: grid;
            grid-template-columns: 60px 1fr auto auto;
            gap: 16px;
            align-items: center;
            padding: 18px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(250, 250, 250, 0.9) 100%);
            border: 1px solid rgba(169, 169, 169, 0.2);
            border-radius: 12px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .requested-service-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(222, 0, 0, 0.05), transparent);
            transition: left 0.6s ease;
        }

        .requested-service-item:hover::before {
            left: 100%;
        }

        .requested-service-item:hover {
            border-color: rgba(222, 0, 0, 0.3);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .requested-service-icon {
            font-size: 1.5rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, #2a2a2a 100%);
            border-radius: 12px;
            flex-shrink: 0;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
        }

        .requested-service-item:hover .requested-service-icon {
            transform: scale(1.05);
            background: linear-gradient(135deg, var(--accent) 0%, #8a0615 100%);
        }

        .requested-service-text {
            flex: 1;
            min-width: 0;
        }

        .requested-service-text h4 {
            margin: 0 0 6px 0;
            font-size: 1.1rem;
            font-weight: 800;
            color: #2a2a2a;
            line-height: 1.2;
        }

        .service-detail {
            font-size: 0.9rem;
            color: #666;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .service-notes {
            font-size: 0.8rem;
            color: #666;
            background: rgba(0, 0, 0, 0.03);
            padding: 8px 12px;
            border-radius: 8px;
            border-left: 3px solid var(--accent);
            line-height: 1.4;
            max-height: 60px;
            overflow-y: auto;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .requested-service-price {
            font-size: 1rem;
            font-weight: 900;
            color: #2a2a2a;
            background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
            padding: 10px 14px;
            border-radius: 10px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            text-align: center;
            min-width: 100px;
        }

        .requested-service-item:hover .requested-service-price {
            background: linear-gradient(135deg, #de0000, #8a0615);
            color: white;
            transform: scale(1.05);
        }

        .remove-service-btn {
            background: rgba(222, 0, 0, 0.1);
            border: 1px solid rgba(222, 0, 0, 0.3);
            border-radius: 8px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            color: #2a2a2a;
            flex-shrink: 0;
        }

        .remove-service-btn:hover {
            background: var(--accent);
            color: white;
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 4px 12px rgba(222, 0, 0, 0.4);
        }

        .estimate-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #2a2a2a 0%, #1e1e1e 100%);
            color: white;
            padding: 18px 20px;
            border-radius: 12px;
            margin: 20px 0;
            font-size: 1.1rem;
            font-weight: 700;
            border: 1px solid rgba(222, 0, 0, 0.3);
            box-shadow: var(--shadow-md);
        }

        #totalAmount {
            color: #ffffff;
            font-size: 1.3rem;
            font-weight: 900;
            background: linear-gradient(135deg, #de0000, #8a0615);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 8px rgba(222, 0, 0, 0.3);
        }

        /* ========== ACTION BUTTONS ========== */
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            padding: 0;
            margin: 20px 0 0 0;
        }

        .clear-all-btn {
            background: linear-gradient(135deg, #666 0%, #8a8a8a 100%);
            color: white;
            border: none;
            padding: 14px 16px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .clear-all-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .clear-all-btn:hover::before {
            left: 100%;
        }

        .clear-all-btn:hover {
            background: linear-gradient(135deg, #8a8a8a 0%, #666 100%);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .book-more-button {
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            font-weight: 700;
            color: #2a2a2a;
            border: 2px solid rgba(222, 0, 0, 0.2);
            box-shadow: var(--shadow-sm);
            padding: 14px 16px;
            font-size: 0.9rem;
            cursor: pointer;
            border-radius: 10px;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .book-more-button:hover {
            background: linear-gradient(135deg, #f8f8f8 0%, #ffffff 100%);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--accent);
            color: var(--accent);
        }

        .checkout-button {
            background: radial-gradient(circle, transparent 5%, #de0000 40%, #8a0615 60%, #8a0615 90%);
            font-weight: 800;
            color: #fff;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 16px 20px;
            font-size: 1rem;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-md);
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
            grid-column: 1 / -1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .checkout-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .checkout-button:hover::before {
            left: 100%;
        }

        .checkout-button:hover {
            background: radial-gradient(circle, #de0000 5%, #8a0615 40%, #de0000 60%, transparent 90%);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 20px rgba(222, 0, 0, 0.4);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .back-button {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--accent);
            padding: 0.75rem 1.25rem;
            border-radius: 8px;
            font-weight: 300;
            font-size: small;
            cursor: pointer;
            transition: all 0.2s ease;
            display: block;
            margin-top: 1rem;
        }

        .back-button:hover {
            background: rgba(222, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .back-button::before {
            content: "←";
            margin-right: 0.5rem;
        }

        /* ========== INVOICE CARD ========== */
        .card-invoices {
            display: block;
            border: 1px outset rgba(0, 0, 0, .75);
            background: rgba(255, 255, 255, 1);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            text-align: center;
            padding: 20px;
            margin: 15px auto;
            overflow: hidden;
            box-sizing: border-box;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
        }

        .card-invoices h1 {
            color: #000;
            font-size: 5vw;
        }

        .card-invoices p {
            color: #666;
        }

        .client-login {
            background: radial-gradient(circle, #454545 5%, #de0000 40%, #8a0615 60%, #8a0615 90%);
            font-weight: 700;
            color: #fff;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 1rem 2rem;
            font-size: 16px;
            margin-top: 1rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            justify: center;
        }

        .client-login::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), #de0000);
            transition: left 0.6s ease;
        }

        .client-login:hover::before {
            left: 100%;
        }

        .client-login:hover {
            background: linear-gradient(135deg, #454545 0%, #8a0615 40%, #de0000 60%, #de0000 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(222, 0, 0, 0.4);
            border-color: rgba(255, 255, 255, 0.5);
        }

        /* ========== FOOTER ========== */
        footer {
            display: flex;
            font-weight: 700;
            color: #FFF;
            text-align: middle;
            justify-content: center;
            margin-top: 4rem;
        }

        footer a {
            font-size: 10px;
            margin: 2% 2%;
            color: #fff;
            font-weight: 700;
        }

        /* ========== ANIMATIONS & EFFECTS ========== */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes invoiceSlideIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes tapAnimation {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(0.92);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: var(--shadow-md);
            }

            50% {
                transform: scale(1.05);
                box-shadow: var(--shadow-lg);
            }

            100% {
                transform: scale(1);
                box-shadow: var(--shadow-md);
            }
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            20%,
            60% {
                transform: translateX(-5px);
            }

            40%,
            80% {
                transform: translateX(5px);
            }
        }

        .tap-animate {
            animation: tapAnimation 0.3s ease;
        }

        .pulse-animate {
            animation: pulse 2s infinite;
        }

        .shake-animate {
            animation: shake 0.5s ease;
        }

        /* ========== RESPONSIVE ADJUSTMENTS ========== */
        /* Medium devices (tablets, 768px and down) */
        @media (max-width: 768px) {
            body {
                padding: 8px;
            }

            .qrc_page_inner {
                padding: 2px;
                padding-bottom: 80px;
            }

            .header {
                padding: 10px;
                margin: 8px;
            }

            .header h1 {
                font-size: 1rem;
            }
        }

        /* Small devices (phones, 480px and down) */
        @media (max-width: 480px) {
            body {
                padding: 8px;
            }

            .qrc_page_inner {
                padding: 2px;
                padding-bottom: 80px;
            }

            /* Categories Grid */
            #categories-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 6px;
                margin: 10px auto;
            }

            .category-tile {
                padding: 12px 6px;
            }

            .category-tile h2 {
                font-size: 0.85rem;
            }

            .category-icon {
                font-size: 1.8rem;
                margin-bottom: 6px;
            }

            /* Service Selection */
            #serviceRequestContainer,
            #servicedetailsContainer {
                padding: 10px;
                margin: 6px auto;
                width: calc(100% - 2px);
            }

            .service-item-grid {
                gap: 6px;
            }

            .service-item-card {
                padding: 0.5rem;
                min-height: 110px;
                border-radius: 8px;
            }

            .service-item-card h4 {
                font-size: 0.8rem;
                margin: 0.25rem 0;
                -webkit-line-clamp: 2;
            }

            .service-item-card p {
                font-size: 0.6rem;
                margin: 0.15rem 0;
                -webkit-line-clamp: 2;
            }

            .service-price {
                font-size: 0.7rem;
                padding: 0.25rem 0.4rem;
                margin: 0.15rem 0;
            }

            .service-item-icon {
                font-size: 1.4rem;
                margin-bottom: 0.15rem;
            }

            /* Selected Services */
            #serviceRequestSection {
                padding: 12px;
                margin: 10px auto;
            }

            #serviceRequestList {
                padding: 10px;
                gap: 8px;
            }

            .requested-service-item {
                grid-template-columns: 50px 1fr;
                gap: 12px;
                padding: 16px;
            }

            .requested-service-icon {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
                grid-row: 1 / 3;
            }

            .requested-service-price {
                grid-column: 2;
                justify-self: start;
                font-size: 0.9rem;
                padding: 8px 12px;
                min-width: 80px;
            }

            .remove-service-btn {
                grid-column: 2;
                justify-self: end;
                width: 36px;
                height: 36px;
                font-size: 0.8rem;
            }

            .requested-service-text h4 {
                font-size: 0.95rem;
                margin-bottom: 4px;
            }

            .service-detail {
                font-size: 0.8rem;
                margin-bottom: 6px;
            }

            .service-notes {
                font-size: 0.75rem;
                padding: 6px 10px;
                max-height: 50px;
                grid-column: 1 / -1;
            }

            .estimate-total {
                padding: 14px 16px;
                margin: 16px 0;
                font-size: 1rem;
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }

            #totalAmount {
                font-size: 1.1rem;
            }

            /* Action Buttons */
            .action-buttons {
                grid-template-columns: 1fr;
                gap: 10px;
                margin: 16px 0 0 0;
            }

            .clear-all-btn,
            .book-more-button,
            .checkout-button {
                padding: 12px 14px;
                font-size: 0.85rem;
                border-radius: 8px;
                min-height: 48px;
            }

            .checkout-button {
                font-size: 0.95rem;
                order: -1;
            }

            /* Invoice */
            .invoice-content {
                margin: 2%;
                width: 96%;
                max-height: 85vh;
            }

            .invoice-header {
                padding: 1rem;
            }

            .invoice-title {
                font-size: 1.2rem;
            }

            .close-btn {
                width: 32px;
                height: 32px;
                top: 1rem;
                right: 1rem;
            }

            .service-list {
                padding: 1rem;
                max-height: 300px;
            }

            .invoice-service-item {
                grid-template-columns: 50px 1fr;
                gap: 12px;
                padding: 16px;
            }

            .invoice-service-icon {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
                grid-row: 1 / 3;
            }

            .invoice-service-price {
                grid-column: 2;
                justify-self: start;
                font-size: 0.9rem;
                padding: 8px 12px;
                min-width: 80px;
            }

            .invoice-remove-service-btn {
                grid-column: 2;
                justify-self: end;
                width: 36px;
                height: 36px;
                font-size: 0.8rem;
            }

            .invoice-service-text h4 {
                font-size: 0.95rem;
                margin-bottom: 4px;
            }

            .invoice-service-detail {
                font-size: 0.8rem;
                margin-bottom: 6px;
            }

            .invoice-service-notes {
                font-size: 0.75rem;
                padding: 6px 10px;
                max-height: 50px;
                grid-column: 1 / -1;
            }

            .summary-section {
                padding: 1rem;
            }

            .subtotal {
                font-size: 1rem;
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }

            #invoiceTotal {
                font-size: 1.3rem;
            }

            .invoice-action-buttons {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 1rem;
            }

            /* Contact Toolbar */
            .contact-toolbar {
                padding: 8px 4px;
            }

            .contact-toolbar-item {
                padding: 8px 10px;
                min-width: 55px;
            }

            .contact-toolbar-icon {
                font-size: 1.4rem;
                margin-bottom: 4px;
            }

            .contact-toolbar-label {
                font-size: 0.65rem;
            }

            /* Header Elements */
            .highlight-box {
                padding: 10px 12px;
                gap: 1%;
            }

            .thandylogo {
                max-height: 2.5rem;
            }

            .tom_kongerslev img {
                max-height: 30px;
            }

            .contact-button {
                padding: 6px 10px;
                font-size: 0.75rem;
            }

            /* Details Grid */
            .details-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.6rem;
                padding: 1rem;
            }

            .detail-card {
                padding: 0.8rem 0.4rem;
                font-size: 0.8rem;
            }

            /* Furniture Selection */
            .furniture-selection-section {
                margin: 1rem 0;
            }

            .radio-group {
                flex-direction: column;
                gap: 0.8rem;
            }

            .furniture-item-selection {
                flex-direction: column;
                align-items: stretch;
                gap: 0.8rem;
            }

            .furniture-item-selection select {
                min-width: auto;
                width: 100%;
            }

            .selected-furniture-list {
                max-height: 150px;
            }

            .selected-furniture-list li {
                padding: 0.7rem 0.9rem;
                font-size: 0.8rem;
            }
        }

        /* Extra Small Devices (iPhone 5/SE, 320px and down) */
        @media (max-width: 320px) {
            body {
                padding: 5px;
            }

            .qrc_page_inner {
                padding: 1px;
            }

            #categories-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 4px;
            }

            .category-tile {
                padding: 10px 4px;
            }

            .category-tile h2 {
                font-size: 0.75rem;
                line-height: 1.2;
            }

            .category-icon {
                font-size: 1.5rem;
                margin-bottom: 4px;
            }

            .action-buttons {
                gap: 0.6rem;
                padding: 0.6rem;
            }

            .clear-all-btn,
            .book-more-button,
            .checkout-button {
                padding: 0.8rem 1rem;
                font-size: 0.8rem;
                min-height: 45px;
            }

            .invoice-content {
                margin: 1%;
                width: 98%;
            }

            /* Extra small service items */
            .service-item-grid {
                grid-template-columns: 1fr;
                gap: 5px;
            }

            .service-item-card {
                min-height: 100px;
                padding: 0.4rem;
            }

            .service-item-card h4 {
                font-size: 0.75rem;
            }

            .service-item-card p {
                font-size: 0.55rem;
            }
        }
    </style>

    <script src="https://tommichael88.github.io/booktomnyc/js/marquee.js" defer></script>
  
</head>

<body style="font-family:Roboto">
  <div class="pg_background" style="background-image:url(https://github.com/tommichael88/booktomnyc/blob/main/images/tomshandybgmodern.jpg?raw=true)"></div>
  <div class="fab-container"></div>
  <div class="qrc_page_inner">
    <div class="section qrc_gallery">
      <div class="qrc_gallery_wrapper">
        <div class="qrc_gallery_list">
          <div class="profile-image-container">
            <img class="profile-image" src="https://tommichael88.github.io/booktomnyc/images/TomKongerslev_nobg.png?raw=true" alt="Profile Image">
          </div>

          <span class="highlight-box">
            <img class="thandylogo" src="https://raw.githubusercontent.com/tommichael88/booktomnyc/refs/heads/main/images/TomsHandyTech_logo_today_lowres_nobg.png" alt="HandyTech logo">
            <div class="tom_kongerslev">
              <img src="https://tommichael88.github.io/booktomnyc/images/tmk_ai_signature_2b2.png?raw=true" alt="Tom Kongerslev signature">
            </div>
            <button id="contactBtn" class="contact-button" style="font-size:.85rem">contact ≣️</button>
          </span>

          <!-- Contact Toolbar -->
          <div id="contactToolbar" class="contact-toolbar">
            <a href="mailto:booktom@icloud.com" class="contact-toolbar-item">
              <div class="contact-toolbar-icon">@</div>
              <div class="contact-toolbar-label"></div>
            </a>
            <a href="tel:+19294501977" class="contact-toolbar-item">
              <div class="contact-toolbar-icon">📞</div>
              <div class="contact-toolbar-label"></div>
            </a>
            <a href="#" id="contactCardButton" class="contact-toolbar-item">
              <div class="contact-toolbar-icon">👤</div>
              <div class="contact-toolbar-label"></div>
            </a>
            <a href="sms:+19294501977" class="contact-toolbar-item">
              <div class="contact-toolbar-icon">💬</div>
              <div class="contact-toolbar-label"></div>
            </a>
          </div>

          <div class="card-schedule-service">
            <h1 style="color:#454545;text-align:center;font-size:2rem;line-height:.85; margin-bottom:2.5rem;margin-top:3rem;">
              <img src="https://github.com/tommichael88/booktomnyc/blob/main/images/calendar.png?raw=true" style="max-width:45px;height:auto;padding:2px" alt="Service Calendar Icon"><br>
              <font><i>SERVICE</i></font><br>
              <b>SCHEDULE</b>
            </h1>
            <a href="https://tommichael88.github.io/booktomnyc/cat.html" style="text-decoration: none; color: inherit;">
              <div class="new-service-request-grid-topper" style="display:flex;justify-content:space-between;align-items:center;font-size:1rem;background: linear-gradient(25deg,#000 1%,#8a0615 20%,#de0000 40%,#8a0615 60%,#000 95%);color:#fff;">
                <span><u>ᴺᵉʷ</u> <b>Service Request ▼</b></span>
            </a>
            <button class="reschedule-service-button" id="manageVisitBtn"><img src="https://github.com/tommichael88/booktomnyc/blob/main/images/Copilot_20251010_033614.png?raw=true" style="max-height:1.25rem;max-width:auto">Edit</button>
          </div>

          <!-- Category tiles etc (kept as in QR.txt) -->
          <div class="menu-container" id="categories-grid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:0;margin-bottom:0">
            <div class="category-tile" data-category="Minor Home Repairs">
              <div class="category-icon">🏠 </div>
              <h2>Minor<br>Home Repairs</h2>
            </div>
            <div class="category-tile" data-category="Furniture Fixes & Assembly">
              <div class="category-icon">🛋️</div>
              <h2>Furniture<br>Fixes</h2>
            </div>
            <div class="category-tile" data-category="Wall Mounting">
              <div class="category-icon">🖼</div>
              <h2>Wall<br>Mounting</h2>
            </div>
            <div class="category-tile" data-category="Electrical Help">
              <div class="category-icon">🔌</div>
              <h2>Electrical<br>Help</h2>
            </div>
            <div class="category-tile" data-category="Plumbing Help">
              <div class="category-icon">🚿</div>
              <h2>Plumbing<br>Help</h2>
            </div>
            <div class="category-tile" data-category="Computer Repairs">
              <div class="category-icon">💻</div>
              <h2>Computer Repairs</h2>
            </div>
          </div>

          <div id="cartFab" class="fab-container" style="display:none">
            <button class="fab" id="fabButton">
              📃 <span id="fabCartCount">0</span>
            </button>
          </div>

          <!-- overlays and containers (kept) -->
          <div id="searchinvoice" class="invoice-overlay">
            <div class="invoice-content">
              <div class="invoice-header">
                <h2 class="invoice-title">Search Services</h2>
                <button class="close-btn" id="closeSearchinvoice">×</button>
              </div>
              <input type="text" class="search-input" id="invoiceSearchInput" placeholder="" />
              <div id="invoiceSearchResults" class="service-list"></div>
            </div>
          </div>

          <div id="invoiceOverlay" class="invoice-overlay">
            <div class="invoice-content">
              <div class="invoice-header">
                <h2 class="invoice-title">Your Service Request</h2>
                <button class="close-btn" id="closeInvoiceOverlay">&nbsp;»&nbsp;️</button>
              </div>
              <div id="invoiceServiceList" class="service-list"></div>
              <div class="summary-section">
                <div class="subtotal">
                  <span>Subtotal (<span id="serviceCount">0</span> items):</span>
                  <span id="invoiceTotal">$0</span>
                </div>
              </div>
              <span class="action-buttons">
                <button class="book-more-button" id="showCategoriesBtn">➕ More Services</button>
                <button class="checkout-button" id="checkoutBtn">★ BOOK ★</button>
              </span>
            </div>
          </div>

          <div id="serviceRequestContainer" style="display:none;">
            <div id="selectedSection"></div>
            <div class="task-details" id="furnituredetailsSection" style="display:none;">
              <h4>Select Your Furniture Item</h4>
              <div>
                <label><input type="radio" name="furnitureType" value="generic"> Furniture [Not IKEA]</label>
                <label><input type="radio" name="furnitureType" value="ikea" checked> IKEA Collection</label>
              </div>
              <select id="furniture-select">
                <option value="">Select Here</option>
              </select>
              <button class="book-more-button" id="addFurnitureInline">Add Furniture Item</button>
              <ul id="selectedFurnitureList"></ul>
              <button class="clear-all-btn" id="clearAllFurnitureInline">Clear All Furniture</button>
            </div>
          </div>

          <div id="servicedetailsContainer" style="display:none"></div>

        </div>

        <div id="serviceRequestSection" style="display:none;">
          <h4>Service Request</h4>
          <div id="serviceRequestList"></div>
          <div id="estimateTotal" class="estimate-total" style="display:none;">
            <span>Estimated Subtotal:</span>
            <span id="totalAmount">$0</span>
          </div>
          <span class="action-buttons">
            <button class="clear-all-btn" id="clearAllServicesBtn">Clear All</button>
            <button class="book-more-button" id="bookMoreBtn">➕ More Services</button>
            <button class="checkout-button" id="bookNowBtn">★ BOOK ★</button>
          </span>
        </div>

      </div>

      <div class="card-invoices" style="color:#fff">
        <br><br>
        <h1 style="color:rgba(155,0,0,.99)">
          <img src="https://tommichael88.github.io/booktomnyc/images/zohoinvoice?raw=true" alt="Zoho Invoice favicon" style="width:3.5rem;height:auto;text-align:center;padding:10px;margin:4px;margin-top:4px"><br>
          <span style="font-size:2.5rem;"><b>INVOICES</b></span>
        </h1>
        <p style="font-size:1rem;padding:4px">view invoices • process payments • digital receipts • review quote estimates • share documents • transaction history • expense receipts</p>
        <button class="client-login" id="clientLoginBtn">🔐 𝗖𝗟𝗜𝗘𝗡𝗧 PORTAL</button>
        <br><br><br>
      </div>

    </div>
  </div>

  <center>
    <h4><img src="https://raw.githubusercontent.com/tommichael88/booktomnyc/refs/heads/main/images/tomshandytech_highresol_today.png" alt="HandyTech logo" style="max-width:150px"></h4>
  </center>

  <footer>
    <a href="https://tommichael88.github.io/booktomnyc/Privacy%20Policy">Privacy Policy</a> |
    <a href="https://tommichael88.github.io/booktomnyc/ServiceAgreement#annex-a">Service Scope</a> |
    <a href="https://tommichael88.github.io/booktomnyc/ServiceAgreement">Service Agreement</a>
  </footer></div>

  <script>
    /* Rewritten and hardened QR page script
       - idempotent initializer
       - central SERVICE_DATA object
       - debounced resize handler + optional ResizeObserver
       - guarded persistence interval
       - no alert() usage; use toast()
       - defensive DOM access
    */

    if (window.__booktom_qr_loaded) {
      // already initialized
    } else {
      window.__booktom_qr_loaded = true;

      (function () {
        'use strict';

        /* ---------- Utilities ---------- */
        const q = (sel, ctx = document) => (ctx || document).querySelector(sel);
        const qAll = (sel, ctx = document) => Array.from((ctx || document).querySelectorAll(sel));
        const create = (tag, props = {}, children = []) => {
          const el = document.createElement(tag);
          for (const k of Object.keys(props || {})) {
            if (k === 'class') el.className = props[k];
            else if (k === 'text') el.textContent = props[k];
            else if (k === 'html') el.innerHTML = props[k];
            else el.setAttribute(k, props[k]);
          }
          for (const c of (children || [])) {
            if (typeof c === 'string') el.appendChild(document.createTextNode(c));
            else if (c instanceof Node) el.appendChild(c);
          }
          return el;
        };
        const safeText = (n, t) => { if (n) n.textContent = t; };
        const parsePriceToInt = s => {
          if (!s || typeof s !== 'string') return 0;
          const m = s.match(/(\d+(?:\.\d+)?)/);
          return m ? Math.round(parseFloat(m[1])) : 0;
        };

        function toast(msg) {
          try {
            const id = 'booktom-toast';
            let root = document.getElementById(id);
            if (!root) {
              root = create('div', { id });
              Object.assign(root.style, {
                position: 'fixed',
                right: '12px',
                bottom: '12px',
                zIndex: 14000,
                display: 'flex',
                flexDirection: 'column',
                gap: '8px',
                alignItems: 'flex-end'
              });
              document.body.appendChild(root);
            }
            const el = create('div', { });
            Object.assign(el.style, {
              background: 'rgba(0,0,0,0.85)',
              color: '#fff',
              padding: '8px 12px',
              borderRadius: '8px',
              boxShadow: '0 6px 18px rgba(0,0,0,0.3)',
              maxWidth: '320px',
              fontSize: '13px'
            });
            el.textContent = msg;
            root.appendChild(el);
            setTimeout(() => el.remove(), 3000);
          } catch (_) { /* noop */ }
        }

        /* ---------- debounce helper (requestAnimationFrame-friendly) ---------- */
        function debounce(fn, wait = 220) {
          let timeout = null;
          let raf = null;
          return function (...args) {
            const ctx = this;
            if (timeout) clearTimeout(timeout);
            if (raf) cancelAnimationFrame(raf);
            if (wait <= 16) {
              raf = requestAnimationFrame(() => fn.apply(ctx, args));
            } else {
              timeout = setTimeout(() => fn.apply(ctx, args), wait);
            }
          };
        }

        /* ---------- Centralized service data (canonical single source) ---------- */
        window.SERVICE_DATA = window.SERVICE_DATA || (function () {
          const FURNITURE_MINUTES = {
            "BEKANT - Desk with underframe": 40, "BESTA - Single frame, shelves, floor standing": 30, "BESTA - Single frame, door / drawer, floor standing": 45,
            "BESTA - Single frame, wall mounting": 30, "BILLY - Bookcase one frame": 40, "BJURSTA - Extendable table": 45,
            "BRIMNES - Bed frame": 45, "BRIMNES - 2 drawer chest": 30, "BRIMNES - 3 drawer chest": 40, "BRIMNES - 4 drawer chest": 50,
            "BRIMNES - Bed frame with storage": 150, "BRIMNES - Headboard": 60, "BRIMNES - Wardrobe with 2 doors": 60, "BRIMNES - Wardrobe with 3 doors": 70,
            "BRIMNES - Nightstand": 20, "BRIMNES - Daybed with 2 drawers": 135, "BRUSALI - Bed frame": 70, "BRUSALI - Bed with 4 storage boxes": 120,
            "BRUSALI - 3 drawer chest": 70, "BRUSALI - Nightstand": 20, "FINGAL - Swivel chair": 15, "FRIHETEN - Sofa bed with chaise": 50,
            "GALANT - 2 drawer unit": 75, "GALANT - 3 drawer unit": 95, "GALANT - 4 drawer unit": 110, "GALANT - Cabinet with sliding doors": 150,
            "HEMNES - Bed frame": 70, "HEMNES - 2 drawer chest": 40, "HEMNES - 3 drawer chest": 70, "HEMNES - 6 drawer chest": 90,
            "HEMNES - 8 drawer dresser": 105, "HEMNES - Nightstand": 20, "HEMNES - Daybed with 3 drawers": 150, "KALLAX - Shelving unit 5x5": 60,
            "KALLAX - Shelving unit 4x4": 45, "KALLAX - Shelving unit 2x4": 40, "KALLAX - Shelving unit 1x4": 35, "KALLAX - Shelving unit 2x2": 20,
            "KALLAX - Insert with 2 drawers": 20, "KALLAX - Insert with door": 15, "LACK - Side table": 10, "LACK - Coffe table": 15, "LACK - TV Unit": 20,
            "LINNMON ADILS - Table (table top and four legs)": 15, "MALM - Bed frame": 45, "MALM - Bed frame with 4 storage boxes": 95,
            "MALM - 2 drawer chest": 30, "MALM - 3 drawer chest": 40, "MALM - 4 drawer chest": 50, "MALM - 6 drawer chest": 70,
            "MALM - 6 drawer dresser": 90, "MALM - Lift bed": 240, "MICKE - Desk with 1 drawer": 30, "MICKE - Desk with drawers, integrated storage": 40,
            "MICKE - Add-on unit": 40, "MORVIK - Wardrobe": 120, "PAX - One frame, hinged doors, up to 3 addons": 180,
            "PAX - Two frames, sliding doors, up to 5 addons": 480, "SODERHAMN - Sofa one seat section with cover": 30,
            "TRYSIL - Bed frame": 45, "TRYSIL - 3 drawer chest": 40, "TRYSIL - Nightstand": 20, "TRYSIL - Wardrobe": 150
          };
          const GENERIC_FURNITURE_MINUTES = {
            "Desk": 40, "Chair": 25, "Bookcase": 40, "Dresser": 70, "Bed Frame": 60, "Sofa": 60, "Table": 45,
            "Cabinet": 90, "Shelving Unit": 60, "Wardrobe": 120, "Side table": 15, "Coffee table": 20, "TV Unit": 25, "Nightstand": 20
          };
          const RATE_PER_HOUR = 40.0;
          const REPAIR_RATE_PER_HOUR = 70.0;

          const categoryIcons = {
            "Minor Home Repairs": "🏠",
            "Furniture Fixes": "🛋️",
            "Wall Mounting": "🧱",
            "Electrical Help": "💡",
            "Plumbing Help": "🚿",
            "Computer Repairs": "💻"
          };

          const serviceIcons = {
            "Drywall repair": "⬜", "Door repair": "🚪", "Window repair": "🪟", "Tile repair": "𝄜",
            "Assembly": "🪛", "Repair": "🧰️", "Moving": "🏃‍", "Disassembly": "🪓", "TV mounting": "📺",
            "Shelf Install": "📚", "Picture hanging": "🖼️", "Mirror Install": "🪞", "Light fixture Install": "💡",
            "Outlet repair": "🔌", "Switch replacement": "🔘", "Ceiling fan Install": "🌀", "Faucet repair": "🚰",
            "Toilet repair": "🚽", "Drain cleaning": "🪠", "Pipe leak repair": "🚿", "Virus removal": "🦠",
            "Hardware upgrade": "💾", "Software Install": "💿", "Data recovery": "🖴"
          };

          const furnitureOptions = [
            { category: "BEKANT", items: ["Desk + underframe"] },
            { category: "BESTA", items: ["Single frame, shelves/floor standing", "Single frame, door/drawer, floor standing", "Single frame/wall mounting"] },
            { category: "BILLY", items: ["Bookcase 1x frame"] }, { category: "BJURSTA", items: ["Extendable table"] },
            { category: "BRIMNES", items: ["Bed frame", "2 drawer chest", "3 drawer chest", "4 drawer chest", "Bed frame & storage", "Headboard", "Wardrobe 2x doors", "Wardrobe 3x doors", "Nightstand", "Daybed 2x drawers"] },
            { category: "BRUSALI", items: ["Bed frame", "Bed + 4 storage boxes", "3 drawer chest", "Nightstand"] },
            { category: "FINGAL", items: ["Swivel chair"] }, { category: "FRIHETEN", items: ["Sofa bed & chaise"] },
            { category: "GALANT", items: ["2x drawer", "3x drawer", "4x drawer", "Cabinet (sliding doors)"] }, { category: "HEMNES", items: ["Bed frame", "2 drawer chest", "3 drawer chest", "6 drawer chest", "Dresser 8x drawer", "Nightstand", "Daybed & 3 drawers"] },
            { category: "KALLAX", items: ["Shelving unit 5x5", "Shelving unit 4x4", "Shelving unit 2x4", "Shelving unit 1x4", "Shelving unit 2x2", "Insert + 2 drawers", "Insert + door"] },
            { category: "LACK", items: ["Side table", "Coffe table", "TV Unit"] }, { category: "LINNMON ADILS", items: ["Table (table top and four legs)"] },
            { category: "MALM", items: ["Bed Frame", "Bed Frame + 4 Storage boxes", "2 Drawer Chest", "3 Drawer Chest", "4 Drawer Chest", "6 Drawer Chest", "6 Drawer Dresser", "Lift bed"] },
            { category: "MICKE", items: ["Desk + 1 Drawer", "Desk + Drawers & Storage", "Add-on unit"] }, { category: "MORVIK", items: ["Wardrobe"] },
            { category: "PAX", items: ["One frame, hinged doors, up to 3 addons", "Two frames, sliding doors, up to 5 addons"] },
            { category: "SODERHAMN", items: ["Sofa one seat section + cover"] }, { category: "TRYSIL", items: ["Bed Frame", "3 Drawer Chest", "Nightstand", "Wardrobe"] },
            { category: "OTHER NOT LISTED", items: ["NOT LISTED or UNKNOWN"] }
          ];

          const serviceData = {
            "Minor Home Repairs": {
              "Appliances": { price: "$70/hour", description: "Appliance assessment, maintenance, and repair services.", icon: "🎛️", details: ["Maintenance", "Repair", "Assessment"] },
              "Handles & Locks Installation": { price: "$70", description: "Installation of door hardware and security locks.", icon: "🔒", details: ["Standard door", "Security lock", "Smart lock"] },
              "Furniture Repair ⏲Hourly Service": { price: "$70/hour", description: "Furniture repair and restoration services.", icon: "🪑", details: ["Wood furniture", "Upholstery", "Metal furniture"] },
              "Door Damage Repair": { price: "$125", description: "Repair and painting for interior door damage.", icon: "🚪", details: ["Patch & paint", "Hinge repair", "Frame adjustment"] },
              "Drywall Repair : Patch & Paint": { price: "$70", description: "Drywall repair with patching and painting included.", icon: "⬜", details: ["Small hole", "Large hole", "Crack Repair"] }
            },
            "Furniture Fixes & Assembly": {
              "Assembly": { price: "$40/hour", description: "Professional furniture assembly service.", icon: "🛠️", details: ["Standard Assembly"], requiresFurnitureSelection: true },
              "Repair": { price: "$70/hour", description: "Furniture repair and restoration services.", icon: "🔨", details: ["Standard Repair"], requiresFurnitureSelection: true }
            },
            "Wall Mounting": {
              "Curtains/Drapes w. Single Rod Installation": { price: "$50", description: "Curtain and drapery rod installation.", icon: "🪟", details: ["Standard rod", "Tension rod", "Decorative rod"] },
              "Frame/Shelf Mounting ⏲Hourly Service": { price: "$60/hour", description: "Wall mounting for frames and shelves.", icon: "📚", details: ["Picture frames", "Shelves", "Wall art"] },
              "TV Mounting (Under 60\") + Concealed Cables": { price: "$150", description: "TV mounting with hidden cable management.", icon: "📺", details: ["Drywall", "Concrete", "Brick"] },
              "TV Mounting (Under 60\") standard": { price: "$60", description: "Basic TV mounting service.", icon: "📺", details: ["Basic mounting", "Tilt mount", "Swivel mount"] }
            },
            "Computer Repairs": {
              "Data": { price: "$99", description: "Data backup and transfer services.", icon: "💾", details: ["External drive", "Cloud backup", "Network transfer"] },
              "Diagnostic Service": { price: "$75", description: "Hardware and software diagnostics.", icon: "🔍", details: ["Part", "Upgrade", "Software"] },
              "Hardware": { price: "$125", description: "PC hardware replacement and upgrades.", icon: "🪫", details: ["RAM", "SSD", "GPU"] },
              "Maleware & Virus": { price: "$125", description: "Virus removal and system protection.", icon: "🦠", details: ["Scan & remove", "System cleanup", "Prevention setup"] },
              "Software": { price: "$50", description: "Software installation and updates.", icon: "📀", details: ["OS", "Applications", "Drivers"] },
              "System Recovery": { price: "$125", description: "PC restoration and system recovery.", icon: "⏮️", details: ["Factory reset", "Backup restore"] }
            },
            "Electrical Help": {
              "Light Fixture Swap": { price: "$60", description: "Light fixture replacement and installation.", icon: "💡", title: "Please choose the appropriate fixture for the install", details: ["Ceiling light", "Wall sconce", "Pendant light"] }
            },
            "Plumbing Help": {
              "Bidet Accessory Install/Removal": { price: "$70", description: "Bidet installation and removal services.", icon: "🚽", details: ["Standard bidet", "Smart bidet"] },
              "Fixture Swap (Cosmetic)": { price: "$70", description: "Faucet and shower head replacement.", icon: "🚰", details: ["Faucet", "Shower head", "Drain cover"] },
              "Leak Under Sink Repair": { price: "$75", description: "Under-sink leak repair services.", icon: "💧", details: ["Pipe leak", "Drain leak"] },
              "Unclog Sink/Shower/Toilet (Minor)": { price: "$70", description: "Drain and clog clearing services.", icon: "🪠", details: ["Plunger", "Drain snake", "Chemical treatment"] }
            }
          };

          return {
            FURNITURE_MINUTES,
            GENERIC_FURNITURE_MINUTES,
            RATE_PER_HOUR,
            REPAIR_RATE_PER_HOUR,
            categoryIcons,
            serviceIcons,
            furnitureOptions,
            serviceData
          };
        })();

        /* ---------- Small billing helpers (pure functions) ---------- */
        function computeFurnitureCharge(itemsMinutes) {
          if (!Array.isArray(itemsMinutes) || itemsMinutes.length === 0) return { hours: 0, price: 0, minutes: 0 };
          const totalMinutes = itemsMinutes.reduce((a, b) => a + b, 0);
          let hours = (totalMinutes < 60) ? 1 : (totalMinutes / 60);
          const hoursRounded = Math.round(hours * 100) / 100;
          const price = Math.round(hoursRounded * window.SERVICE_DATA.RATE_PER_HOUR * 100) / 100;
          return { hours: hoursRounded, price, minutes: totalMinutes };
        }
        function computeRepairCharge(hoursInput) {
          let hours = parseFloat(hoursInput) || 0;
          if (hours <= 0) hours = 1;
          const hoursRounded = Math.round(hours * 100) / 100;
          const price = Math.round(hoursRounded * window.SERVICE_DATA.REPAIR_RATE_PER_HOUR * 100) / 100;
          return { hours: hoursRounded, price };
        }

        /* ---------- Persistence & state ---------- */
        const STORAGE_KEY = 'booktom_cart_v1';
        function persistCartPlain(state) {
          try { sessionStorage.setItem(STORAGE_KEY, JSON.stringify(state || [])); } catch (_) { /* noop */ }
        }
        function loadCartPlain() {
          try { const v = sessionStorage.getItem(STORAGE_KEY); return v ? JSON.parse(v) : []; } catch (_) { return []; }
        }

        const State = {
          serviceRequest: loadCartPlain(),
          furnitureItems: []
        };

        /* ---------- DOM refs (created at init) ---------- */
        const DOM = {
          categoriesGrid: null, contactBtn: null, contactToolbar: null,
          cartFab: null, fabCount: null, invoiceOverlay: null, invoiceServiceList: null,
          invoiceTotal: null, serviceCount: null, serviceRequestList: null,
          estimateTotal: null, totalAmount: null, serviceRequestContainer: null,
          servicedetailsContainer: null, selectedSection: null, serviceRequestSection: null,
          scheduleCard: null
        };

        /* ---------- Inject small drawer CSS (kept as before) ---------- */
        (function injectCSS() {
          try {
            const css = `
  #invoiceOverlay { position: fixed; top: 0; right: 0; height: 100vh; width: 92vw; max-width: 420px; transform: translateX(110%); transition: transform 260ms ease; z-index: 20000; background: #fff; box-shadow: -20px 0 40px rgba(0,0,0,0.3); display: block; overflow: hidden; }
  #invoiceOverlay.open { transform: translateX(0%); }
  #invoiceOverlay .drawer-inner { height: 100%; display: flex; flex-direction: column; }
  #invoiceOverlay .drawer-body { padding: 12px; overflow-y: auto; flex: 1 1 auto; }
  #invoiceOverlay .drawer-footer { padding: 12px; border-top: 1px solid #eee; background: #fafafa; flex: 0 0 auto; }
  #invoiceOverlay .drawer-header { display:flex; align-items:center; justify-content:space-between; padding:12px; border-bottom:1px solid #eee; }
  #invoiceOverlay .close-drawer { font-size:20px; background:transparent; border:0; cursor:pointer; }
  .repair-hint { font-size:0.85rem; color:#555; margin-top:6px; margin-bottom:6px; }
  .repair-confirm { display:flex; gap:8px; align-items:center; margin-top:8px; }
  @media (min-width:600px) { #invoiceOverlay { width: 420px; } }
  `;
            const s = document.createElement('style'); s.type = 'text/css'; s.appendChild(document.createTextNode(css)); document.head.appendChild(s);
          } catch (_) { /* noop */ }
        })();

        /* ---------- invoice overlay helpers (defensive) ---------- */
        function ensureInvoiceOverlayExists() {
          let ov = DOM.invoiceOverlay || q('#invoiceOverlay');
          if (ov) {
            DOM.invoiceOverlay = ov;
            DOM.invoiceServiceList = DOM.invoiceServiceList || q('#invoiceServiceList');
            DOM.invoiceTotal = DOM.invoiceTotal || q('#invoiceTotal');
            return ov;
          }
          ov = create('div', { id: 'invoiceOverlay' });
          const inner = create('div', { class: 'drawer-inner' });
          inner.appendChild(create('div', { class: 'drawer-header' }));
          inner.appendChild(create('div', { class: 'drawer-body', id: 'invoiceServiceList' }));
          inner.appendChild(create('div', { class: 'drawer-footer', id: 'invoiceFooter' }));
          ov.appendChild(inner);
          document.body.appendChild(ov);
          DOM.invoiceOverlay = ov;
          DOM.invoiceServiceList = q('#invoiceServiceList');
          DOM.invoiceTotal = q('#invoiceTotal') || null;
          return ov;
        }

        function openInvoiceDrawer() {
          const ov = ensureInvoiceOverlayExists();
          ov.classList.add('open');
          document.body.style.overflow = 'hidden';
        }
        function closeInvoiceDrawer() {
          const ov = ensureInvoiceOverlayExists();
          ov.classList.remove('open');
          document.body.style.overflow = '';
        }

        /* ---------- simple capture/restore UI state ---------- */
        let priorDisplayState = null;
        function capturePriorDisplays() {
          try {
            priorDisplayState = {
              categoriesGrid: DOM.categoriesGrid ? getComputedStyle(DOM.categoriesGrid).display : '',
              serviceRequestContainer: DOM.serviceRequestContainer ? getComputedStyle(DOM.serviceRequestContainer).display : '',
              servicedetailsContainer: DOM.servicedetailsContainer ? getComputedStyle(DOM.servicedetailsContainer).display : '',
              serviceRequestSection: DOM.serviceRequestSection ? getComputedStyle(DOM.serviceRequestSection).display : ''
            };
          } catch (_) { priorDisplayState = null; }
        }
        function restorePriorDisplays() {
          if (!priorDisplayState) return;
          try {
            if (DOM.categoriesGrid) DOM.categoriesGrid.style.display = priorDisplayState.categoriesGrid || 'grid';
            if (DOM.serviceRequestContainer) DOM.serviceRequestContainer.style.display = priorDisplayState.serviceRequestContainer || 'none';
            if (DOM.servicedetailsContainer) DOM.servicedetailsContainer.style.display = priorDisplayState.servicedetailsContainer || 'none';
            if (DOM.serviceRequestSection) DOM.serviceRequestSection.style.display = priorDisplayState.serviceRequestSection || (State.serviceRequest.length ? 'block' : 'none');
          } finally { priorDisplayState = null; }
        }

        /* ---------- render invoice drawer ---------- */
        function renderInvoiceDrawer() {
          const ov = ensureInvoiceOverlayExists();
          const header = ov.querySelector('.drawer-header');
          const body = ov.querySelector('.drawer-body');
          const footer = ov.querySelector('.drawer-footer');
          header.innerHTML = '';
          const title = create('h3', { text: 'Your Cart' });
          const closeBtn = create('button', { class: 'close-drawer', text: '✕', title: 'Close' });
          closeBtn.addEventListener('click', () => { closeInvoiceDrawer(); restorePriorDisplays(); }, { passive: true });
          header.appendChild(title);
          header.appendChild(closeBtn);

          body.innerHTML = '';
          let total = 0;
          State.serviceRequest.forEach(s => {
            const el = create('div', { class: 'requested-service-item' });
            el.appendChild(create('div', { class: 'requested-service-icon', text: s.icon || '🔧' }));
            const tw = create('div', { class: 'requested-service-text' });
            tw.appendChild(create('h4', { text: s.name }));
            tw.appendChild(create('div', { class: 'service-detail', text: s.detail || '' }));
            if (s.notes && (!s.furnitureItems || s.furnitureItems.length === 0)) tw.appendChild(create('div', { class: 'service-notes', text: s.notes }));
            if (s.furnitureItems && s.furnitureItems.length > 0) {
              const fwrap = create('div', { class: 'requested-service-furniture' });
              s.furnitureItems.forEach((fi, idx) => {
                const fitem = create('span', { class: 'f-item' });
                fitem.appendChild(create('span', { text: fi.label }));
                const rem = create('button', { type: 'button', text: '✕' });
                rem.addEventListener('click', () => { removeFurnitureItemFromService(s.id, idx); renderInvoiceDrawer(); }, { passive: true });
                fitem.appendChild(rem);
                fwrap.appendChild(fitem);
              });
              tw.appendChild(fwrap);
            }
            const price = create('div', { class: 'requested-service-price', text: s.price || '$0' });
            const rem = create('button', { class: 'remove-service-btn', text: '✕', type: 'button' });
            rem.addEventListener('click', () => { removeServiceFromCart(s.id); renderInvoiceDrawer(); }, { passive: true });
            el.appendChild(tw); el.appendChild(price); el.appendChild(rem); body.appendChild(el);
            total += parsePriceToInt(s.price);
          });

          footer.innerHTML = '';
          const subtotalRow = create('div', { class: 'drawer-subtotal' });
          subtotalRow.appendChild(create('div', { text: 'Subtotal' }));
          subtotalRow.appendChild(create('div', { text: `$${total}.00`, class: 'drawer-subtotal-amount' }));
          footer.appendChild(subtotalRow);

          const checkoutBtn = create('button', { class: 'checkout-button', text: 'Proceed to Checkout', type: 'button' });
          checkoutBtn.addEventListener('click', () => {
            if (!State.serviceRequest.length) { toast('Your cart is empty.'); return; }
            closeInvoiceDrawer();
            toast('Proceeding to booking...');
            // TODO: implement checkout routing
          }, { passive: true });
          footer.appendChild(checkoutBtn);
        }

        /* ---------- cart helpers ---------- */
        function removeFurnitureItemFromService(serviceId, itemIndex) {
          const svc = State.serviceRequest.find(s => s.id === serviceId);
          if (!svc || !Array.isArray(svc.furnitureItems)) return;
          svc.furnitureItems.splice(itemIndex, 1);
          svc.notes = svc.furnitureItems.length ? 'Furniture Items: ' + svc.furnitureItems.map(f => f.label).join(', ') : svc.notes;
          const isRepair = svc.name && (svc.name.toLowerCase() === 'repair' || svc.name.toLowerCase().includes('repair'));
          if (isRepair) {
            const charge = computeRepairCharge(1);
            svc.estimatedHours = charge.hours;
            svc.estimatedPrice = charge.price;
            svc.price = `$${charge.price.toFixed(2)}`;
          } else {
            if (svc.furnitureItems && svc.furnitureItems.length > 0) {
              const minutes = svc.furnitureItems.map(fi => fi.minutes || (window.SERVICE_DATA.FURNITURE_MINUTES[fi.key] || window.SERVICE_DATA.GENERIC_FURNITURE_MINUTES[fi.label] || 60));
              const charge = computeFurnitureCharge(minutes);
              svc.estimatedHours = charge.hours;
              svc.estimatedPrice = charge.price;
              svc.price = `$${charge.price.toFixed(2)}`;
              svc.notes = (svc.notes || '') + ` Est: ${charge.hours} hr • $${charge.price.toFixed(2)}`;
            } else {
              svc.estimatedHours = 0;
              svc.estimatedPrice = 0;
            }
          }
          persistCartPlain(State.serviceRequest);
          updateserviceRequestUI();
          updateFabVisibility();
        }

        function addToCart(entry) {
          if (!entry || !entry.id) return;
          State.serviceRequest.push(entry);
          updateserviceRequestUI();
          updateFabVisibility();
          persistCartPlain(State.serviceRequest);
        }

        function removeServiceFromCart(id) {
          State.serviceRequest = State.serviceRequest.filter(s => s.id !== id);
          updateserviceRequestUI();
          updateFabVisibility();
          persistCartPlain(State.serviceRequest);
        }

        function updateserviceRequestUI() {
          try {
            const list = DOM.serviceRequestList;
            if (!list) return;
            list.innerHTML = '';
            let total = 0;
            State.serviceRequest.forEach(svc => {
              const item = create('div', { class: 'requested-service-item' });
              item.appendChild(create('div', { class: 'requested-service-icon', text: svc.icon || '🔧' }));
              const tw = create('div', { class: 'requested-service-text' });
              tw.appendChild(create('h4', { text: svc.name }));
              tw.appendChild(create('div', { class: 'service-detail', text: svc.detail || '' }));
              if (svc.notes && (!svc.furnitureItems || svc.furnitureItems.length === 0)) tw.appendChild(create('div', { class: 'service-notes', text: svc.notes }));
              if (svc.furnitureItems && svc.furnitureItems.length > 0) {
                const fwrap = create('div', { class: 'requested-service-furniture' });
                svc.furnitureItems.forEach((fi, idx) => {
                  const fitem = create('span', { class: 'f-item' });
                  fitem.appendChild(create('span', { text: fi.label }));
                  const rem = create('button', { type: 'button', text: '✕' });
                  rem.addEventListener('click', () => removeFurnitureItemFromService(svc.id, idx), { passive: true });
                  fitem.appendChild(rem); fwrap.appendChild(fitem);
                });
                tw.appendChild(fwrap);
                if (svc.notes && svc.notes.trim().length > 0) tw.appendChild(create('div', { class: 'service-notes', text: svc.notes }));
              }
              const price = create('div', { class: 'requested-service-price', text: svc.price || '$0' });
              const rem = create('button', { class: 'remove-service-btn', text: '✕', type: 'button' });
              rem.addEventListener('click', () => removeServiceFromCart(svc.id), { passive: true });
              item.appendChild(tw); item.appendChild(price); item.appendChild(rem); list.appendChild(item);
              total += parsePriceToInt(svc.price);
            });
            if (State.serviceRequest.length > 0) {
              if (DOM.estimateTotal) DOM.estimateTotal.style.display = 'flex';
              if (DOM.totalAmount) safeText(DOM.totalAmount, `$${total}.00`);
              if (DOM.serviceRequestSection) DOM.serviceRequestSection.style.display = 'block';
            } else {
              if (DOM.estimateTotal) DOM.estimateTotal.style.display = 'none';
              if (DOM.serviceRequestSection) DOM.serviceRequestSection.style.display = 'none';
            }
            if (DOM.serviceCount) safeText(DOM.serviceCount, String(State.serviceRequest.length));
            if (DOM.fabCount) safeText(DOM.fabCount, String(State.serviceRequest.length));
            persistCartPlain(State.serviceRequest);
          } catch (e) { console.error(e); }
        }

        function updateFabVisibility() {
          try {
            if (!DOM.cartFab || !DOM.fabCount) return;
            if (State.serviceRequest.length > 0) {
              DOM.cartFab.style.display = 'block';
              safeText(DOM.fabCount, String(State.serviceRequest.length));
            } else DOM.cartFab.style.display = 'none';
          } catch (_) { /* noop */ }
        }

        /* ---------- category tile handling ---------- */
        function buildCategoryTiles() {
          const grid = DOM.categoriesGrid;
          if (!grid) return;
          grid.style.touchAction = 'manipulation';
          grid.addEventListener('touchstart', ev => {
            try {
              const tile = ev.target.closest && ev.target.closest('.category-tile');
              if (!tile) return;
              handleCategorySelect(tile.dataset.category);
            } catch (_) {}
          }, { passive: true });
          grid.addEventListener('click', ev => {
            try {
              const tile = ev.target.closest && ev.target.closest('.category-tile');
              if (!tile) return;
              handleCategorySelect(tile.dataset.category);
            } catch (_) {}
          }, { passive: true });
          qAll('.category-tile', grid).forEach(tile => {
            if (!tile.hasAttribute('tabindex')) tile.setAttribute('tabindex', '0');
            tile.addEventListener('keydown', ev => {
              if (ev.key === 'Enter' || ev.key === ' ') { ev.preventDefault(); tile.click(); }
            });
          });
        }

        function showCategories() {
          if (DOM.categoriesGrid) DOM.categoriesGrid.style.display = 'grid';
          if (DOM.serviceRequestContainer) DOM.serviceRequestContainer.style.display = 'none';
          if (DOM.servicedetailsContainer) DOM.servicedetailsContainer.style.display = 'none';
          if (DOM.selectedSection) DOM.selectedSection.innerHTML = '';
          if (DOM.serviceRequestSection) DOM.serviceRequestSection.style.display = 'none';
        }

        function handleCategorySelect(category) {
          try {
            if (!category) return;
            if (DOM.categoriesGrid) DOM.categoriesGrid.style.display = 'none';
            const sel = DOM.selectedSection;
            if (!sel) return;
            sel.innerHTML = '';
            sel.appendChild(create('h3', { text: `${category} Services` }));
            const gridBox = create('div', { class: 'service-item-grid' });
            const cat = window.SERVICE_DATA.serviceData[category] || null;
            if (!cat) {
              gridBox.appendChild(create('p', { text: 'No services for this category.' }));
              sel.appendChild(gridBox);
              return;
            }
            Object.keys(cat).forEach(svc => {
              const info = cat[svc];
              const card = create('div', { class: 'service-item-card', tabindex: '0', role: 'button', 'data-service': svc });
              card.appendChild(create('div', { class: 'service-item-icon', text: info.icon || '🔧' }));
              card.appendChild(create('h4', { text: svc }));
              card.appendChild(create('p', { text: info.description || '' }));
              card.appendChild(create('div', { class: 'service-price', text: info.price || '' }));
              card.addEventListener('click', () => showServiceDetails(category, svc), { passive: true });
              card.addEventListener('keydown', ev => { if (ev.key === 'Enter' || ev.key === ' ') { ev.preventDefault(); showServiceDetails(category, svc); } });
              gridBox.appendChild(card);
            });
            sel.appendChild(gridBox);
            const back = create('button', { class: 'back-button', text: 'Back to Categories', type: 'button' });
            back.addEventListener('click', () => { showCategories(); }, { passive: true });
            sel.appendChild(back);
            if (DOM.serviceRequestContainer) DOM.serviceRequestContainer.style.display = 'block';
            if (DOM.servicedetailsContainer) DOM.servicedetailsContainer.style.display = 'none';
            sel.scrollIntoView({ behavior: 'smooth', block: 'start' });
          } catch (e) { console.error(e); }
        }

        /* ---------- detailed service view ---------- */
        function showServiceDetails(category, svc) {
          try {
            if (!category || !svc) return;
            const info = window.SERVICE_DATA.serviceData[category] && window.SERVICE_DATA.serviceData[category][svc] ? window.SERVICE_DATA.serviceData[category][svc] : null;
            const container = DOM.servicedetailsContainer;
            if (!container) return;
            if (DOM.categoriesGrid) DOM.categoriesGrid.style.display = 'none';
            if (DOM.serviceRequestContainer) DOM.serviceRequestContainer.style.display = 'none';
            container.innerHTML = '';
            container.style.display = 'block';
            container.appendChild(create('h3', { text: svc }));
            if (!info) { container.appendChild(create('p', { text: 'Service information not found.' })); return; }

            const notes = create('textarea', { class: 'service-input-area', id: 'serviceNoteInput_' + Date.now(), name: 'serviceNoteInput' });
            notes.style.display = 'none';
            notes.placeholder = info.requiresFurnitureSelection ? 'Add any additional notes about the furniture assembly/repair here...' : 'Add job details and notes here...';

            const addBtn = create('button', { class: 'book-more-button', text: 'Add to Cart', type: 'button', 'aria-label': 'Add service to cart' });
            addBtn.style.display = 'none';
            addBtn.disabled = true;
            const enableAddAfterText = () => {
              if (notes.value && notes.value.trim().length > 0) { addBtn.style.display = ''; addBtn.disabled = false; }
              else { if (State.furnitureItems && State.furnitureItems.length > 0) { addBtn.style.display = ''; addBtn.disabled = false; } else { addBtn.style.display = 'none'; addBtn.disabled = true; } }
            };
            notes.addEventListener('input', enableAddAfterText, { passive: true });

            if (!info.requiresFurnitureSelection) {
              const detailsGrid = create('div', { class: 'details-grid' });
              (info.details || []).forEach(detail => {
                const card = create('div', { class: 'detail-card', text: detail, tabindex: '0', role: 'button' });
                card.addEventListener('click', () => {
                  Array.from(detailsGrid.children).forEach(c => c.classList.remove('selected'));
                  card.classList.add('selected');
                  notes.style.display = '';
                  notes.placeholder = `${detail} — add notes here`;
                  notes.focus();
                  enableAddAfterText();
                }, { passive: true });
                detailsGrid.appendChild(card);
              });
              container.appendChild(detailsGrid);
            } else {
              const isRepair = svc.toLowerCase() === 'repair' || svc.toLowerCase().includes('repair');
              const fs = create('div', { class: 'furniture-selection-section' });
              fs.appendChild(create('h4', { text: isRepair ? 'Specify Furniture to Repair (Not IKEA)' : 'Select Furniture Item for Assembly' }));

              const radioGroup = create('div', { class: 'radio-group' });
              const uniqueName = 'ftype_' + Date.now() + '_' + Math.floor(Math.random() * 1e6);
              const lbNotIkea = create('label');
              const notIkeaRadio = create('input', { type: 'radio', name: uniqueName, value: 'generic' });
              notIkeaRadio.checked = isRepair ? true : false;
              lbNotIkea.appendChild(notIkeaRadio); lbNotIkea.appendChild(document.createTextNode(' Not IKEA'));
              radioGroup.appendChild(lbNotIkea);
              let ikeaRadio = null;
              if (!isRepair) {
                const lbIkea = create('label');
                ikeaRadio = create('input', { type: 'radio', name: uniqueName, value: 'ikea' });
                ikeaRadio.checked = true;
                lbIkea.appendChild(ikeaRadio); lbIkea.appendChild(document.createTextNode(' IKEA Collection'));
                radioGroup.appendChild(lbIkea);
              }
              fs.appendChild(radioGroup);

              const selectWrap = create('div', { class: 'furniture-item-selection' });
              const furnitureSelect = create('select', { id: 'furniture-select-' + Math.floor(Math.random() * 1e9), name: 'furnitureSelect' });
              furnitureSelect.appendChild(create('option', { value: '', text: 'Select Furniture Item' }));
              selectWrap.appendChild(furnitureSelect);
              const addItemBtn = create('button', { class: 'add-item-btn', text: 'Add Item', type: 'button' });
              selectWrap.appendChild(addItemBtn);
              fs.appendChild(selectWrap);

              let repairHoursInput = null;
              if (isRepair) {
                const hoursWrap = create('div', { class: 'repair-hours-wrap' });
                hoursWrap.appendChild(create('label', { text: 'Estimated repair hours (minimum 1 hour): ' }));
                repairHoursInput = create('input', { type: 'number', min: '1', step: '0.25', value: '1', id: 'repairHoursInput' });
                repairHoursInput.style.width = '100px';
                hoursWrap.appendChild(repairHoursInput);
                fs.appendChild(hoursWrap);
                const hint = create('div', { class: 'repair-hint', text: 'Final price may change after review. Enter an initial estimate and confirm before adding to cart.' });
                fs.appendChild(hint);
                notes.style.display = '';
              }

              const selectedSection = create('div', { class: 'selected-furniture-section' });
              selectedSection.appendChild(create('h5', { text: 'Your Furniture List' }));
              const selectedList = create('ul', { class: 'selected-furniture-list', id: 'selectedFurnitureListLocal' });
              selectedSection.appendChild(selectedList);
              const removeAllBtn = create('button', { class: 'clear-all-btn', text: 'Remove All Furniture', type: 'button' });
              selectedSection.appendChild(removeAllBtn);
              fs.appendChild(selectedSection);
              container.appendChild(fs);

              function populate(isIkea) {
                while (furnitureSelect.options.length) furnitureSelect.remove(0);
                furnitureSelect.appendChild(create('option', { value: '', text: 'Select Furniture Item' }));
                if (isIkea) {
                  const byCollection = {};
                  Object.keys(window.SERVICE_DATA.FURNITURE_MINUTES).forEach(k => {
                    const [collection, item] = k.split(' - ');
                    if (!collection) return;
                    byCollection[collection] = byCollection[collection] || [];
                    byCollection[collection].push({ key: k, label: k.replace(collection + ' - ', '') });
                  });
                  Object.keys(byCollection).sort().forEach(coll => {
                    const optg = document.createElement('optgroup'); optg.label = coll;
                    (byCollection[coll] || []).forEach(it => {
                      const opt = document.createElement('option'); opt.value = it.key; opt.textContent = it.label; optg.appendChild(opt);
                    });
                    furnitureSelect.appendChild(optg);
                  });
                } else {
                  Object.keys(window.SERVICE_DATA.GENERIC_FURNITURE_MINUTES).sort().forEach(lbl => {
                    const opt = document.createElement('option'); opt.value = lbl; opt.textContent = lbl; furnitureSelect.appendChild(opt);
                  });
                }
              }
              populate(!isRepair && (ikeaRadio ? ikeaRadio.checked : false));
              if (!isRepair && ikeaRadio) [notIkeaRadio, ikeaRadio].forEach(r => r.addEventListener('change', () => populate(ikeaRadio.checked), { passive: true }));
              else populate(false);

              addItemBtn.addEventListener('click', () => {
                const val = furnitureSelect.value;
                if (!val) { toast('Please select a furniture item first.'); return; }
                let minutes = 60; let label = val; let isIkea = (!isRepair && ikeaRadio && ikeaRadio.checked);
                if (isIkea) { minutes = window.SERVICE_DATA.FURNITURE_MINUTES[val] || 60; label = furnitureSelect.options[furnitureSelect.selectedIndex].textContent || val; }
                else { minutes = window.SERVICE_DATA.GENERIC_FURNITURE_MINUTES[val] || 60; label = furnitureSelect.options[furnitureSelect.selectedIndex].textContent || val; }
                const entryObj = { key: val, label, minutes, isIkea: !!isIkea };
                State.furnitureItems.push(entryObj);
                const li = create('li'); li.appendChild(create('span', { text: label }));
                const rem = create('button', { text: '✕', type: 'button' });
                rem.addEventListener('click', () => {
                  const idx = State.furnitureItems.findIndex(fi => fi.key === entryObj.key && fi.label === entryObj.label && fi.minutes === entryObj.minutes);
                  if (idx >= 0) State.furnitureItems.splice(idx, 1); li.remove();
                }, { passive: true });
                li.appendChild(rem); selectedList.appendChild(li); furnitureSelect.value = '';
                if (State.furnitureItems.length > 0) { notes.style.display = ''; notes.placeholder = 'Add any additional notes about the furniture assembly/repair here...'; notes.focus(); enableAddAfterText(); }
              }, { passive: true });

              removeAllBtn.addEventListener('click', () => {
                selectedList.innerHTML = ''; State.furnitureItems = []; notes.style.display = 'none'; addBtn.style.display = 'none'; addBtn.disabled = true;
              }, { passive: true });
            }

            container.appendChild(notes);
            const repairConfirmWrap = create('div', { class: 'repair-confirm-wrap' });
            container.appendChild(repairConfirmWrap);
            const addBtnFinal = addBtn;
            container.appendChild(addBtnFinal);

            addBtnFinal.addEventListener('click', () => {
              const finalNotes = notes ? notes.value.trim() : '';
              const isRepair = svc.toLowerCase() === 'repair' || svc.toLowerCase().includes('repair');
              if (info.requiresFurnitureSelection && (!State.furnitureItems || State.furnitureItems.length === 0) && !isRepair) { toast('Please add at least one furniture item.'); return; }
              if (!info.requiresFurnitureSelection) {
                const sel = container.querySelector('.detail-card.selected');
                if (!sel && finalNotes.length === 0) { toast('Please select a service detail or enter job details.'); return; }
              }

              if (isRepair) {
                let confirmCheckbox = container.querySelector('#repairConfirmCheckbox');
                if (!confirmCheckbox) {
                  const cwrap = create('div', { class: 'repair-confirm' });
                  confirmCheckbox = create('input', { type: 'checkbox', id: 'repairConfirmCheckbox' });
                  const label = create('label', { text: ' I acknowledge final repair pricing may change after physical review or if additional materials or labor is required to satisfy beyond scope of work.' });
                  label.prepend(confirmCheckbox); cwrap.appendChild(label); repairConfirmWrap.appendChild(cwrap);
                  confirmCheckbox.addEventListener('change', () => { enableAddAfterText(); });
                  toast('Please confirm the repair estimate by checking the box before adding to cart.');
                  return;
                }
                if (!confirmCheckbox.checked) { toast('Please confirm that final repair pricing may change after inspection.'); return; }
              }

              const entry = {
                id: `${category}-${svc}-${Date.now()}`,
                category, name: svc, price: info.price || '$0',
                icon: info.icon || '🔧',
                detail: info.requiresFurnitureSelection ? 'Furniture Service' : (container.querySelector('.detail-card.selected') ? container.querySelector('.detail-card.selected').textContent : 'Custom request'),
                notes: finalNotes || (State.furnitureItems.length ? 'Furniture Items: ' + State.furnitureItems.map(f => f.label).join(', ') : ''),
                furnitureItems: info.requiresFurnitureSelection ? State.furnitureItems.map(f => ({ ...f })) : [],
                estimatedHours: 0, estimatedPrice: 0
              };

              if (isRepair) {
                const hoursInputEl = container.querySelector('#repairHoursInput');
                const hoursVal = hoursInputEl ? parseFloat(hoursInputEl.value) : 1;
                const charge = computeRepairCharge(hoursVal);
                entry.estimatedHours = charge.hours; entry.estimatedPrice = charge.price; entry.price = `$${charge.price.toFixed(2)}`;
                entry.notes = (entry.notes || '') + ` ${entry.notes ? '•' : ''} Est: ${charge.hours} hr • $${charge.price.toFixed(2)}`;
              } else {
                if (entry.furnitureItems && entry.furnitureItems.length > 0) {
                  const itemsMinutes = entry.furnitureItems.map(fi => (typeof fi.minutes === 'number' && fi.minutes > 0) ? fi.minutes : (window.SERVICE_DATA.FURNITURE_MINUTES[fi.key] || window.SERVICE_DATA.GENERIC_FURNITURE_MINUTES[fi.label] || 60));
                  const charge = computeFurnitureCharge(itemsMinutes);
                  entry.estimatedHours = charge.hours; entry.estimatedPrice = charge.price; entry.price = `$${charge.price.toFixed(2)}`;
                  entry.notes = (entry.notes || '') + ` ${entry.notes ? '•' : ''} Est: ${charge.hours} hr • $${charge.price.toFixed(2)}`;
                }
              }

              addToCart(entry);
              if (DOM.serviceRequestSection) DOM.serviceRequestSection.style.display = 'block';
              container.style.display = 'none';
              State.furnitureItems = [];
              updateserviceRequestUI(); updateFabVisibility(); persistCartPlain(State.serviceRequest);
              toast('Service added to cart!');
            }, { passive: true });

            const back = create('button', { class: 'back-button', text: 'Back to Services', type: 'button' });
            back.addEventListener('click', () => { container.style.display = 'none'; handleCategorySelect(category); }, { passive: true });
            container.appendChild(back);

          } catch (e) { console.error(e); }
        }

        /* ---------- inline helpers exposed for inline onclicks only (minimal globals) ---------- */
        window.showCategories = showCategories;
        window.clearAllServices = function clearAllServices() {
          State.serviceRequest = []; persistCartPlain(State.serviceRequest); updateserviceRequestUI(); updateFabVisibility();
          if (DOM.serviceRequestSection) DOM.serviceRequestSection.style.display = 'none'; showCategories();
        };
        window.addFurnitureItem = function addFurnitureItemInline() {
          try {
            const sel = q('#furniture-select');
            const list = q('#selectedFurnitureList');
            if (!sel || !list) return;
            const val = sel.value;
            if (!val) { toast('Select a furniture item first'); return; }
            let minutes = window.SERVICE_DATA.FURNITURE_MINUTES[val] || window.SERVICE_DATA.GENERIC_FURNITURE_MINUTES[val] || 60;
            let label = sel.options[sel.selectedIndex] ? sel.options[sel.selectedIndex].textContent : val;
            const entryObj = { key: val, label, minutes, isIkea: !!(window.SERVICE_DATA.FURNITURE_MINUTES[val]) };
            State.furnitureItems.push(entryObj);
            const li = create('li'); li.appendChild(create('span', { text: label }));
            const rem = create('button', { text: '✕', type: 'button' });
            rem.addEventListener('click', () => {
              li.remove(); State.furnitureItems = State.furnitureItems.filter(x => !(x.key === entryObj.key && x.label === entryObj.label && x.minutes === entryObj.minutes));
            }, { passive: true });
            li.appendChild(rem); list.appendChild(li); sel.value = '';
            const dynNotes = q('.service-input-area'); if (dynNotes) dynNotes.style.display = '';
          } catch (e) { console.error(e); }
        };
        window.clearAllFurnitureItems = function clearAllFurnitureItemsInline() {
          try { const list = q('#selectedFurnitureList'); if (list) list.innerHTML = ''; State.furnitureItems = []; const dynNotes = q('.service-input-area'); if (dynNotes) dynNotes.style.display = 'none'; } catch (e) { console.error(e); }
        };

        /* ---------- FAB wiring ---------- */
        function wireContactToolbar() {
  const contactBtn = q('#contactBtn');
  const contactToolbar = q('#contactToolbar');
  if (!contactBtn || !contactToolbar) return;

  contactBtn.setAttribute('aria-controls', 'contactToolbar');
  contactBtn.setAttribute('aria-expanded', 'false');
  contactToolbar.setAttribute('role', 'menu');
  contactToolbar.setAttribute('tabindex', '-1');
  contactToolbar.querySelectorAll('a, button').forEach(el => el.setAttribute('role', 'menuitem'));

  contactBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    const isOpen = contactToolbar.classList.toggle('active');
    contactBtn.setAttribute('aria-expanded', String(isOpen));
    if (isOpen) contactToolbar.focus();
  });

  contactBtn.addEventListener('keydown', (ev) => {
    if (ev.key === 'Enter' || ev.key === ' ') { ev.preventDefault(); contactBtn.click(); }
    if (ev.key === 'Escape') { contactToolbar.classList.remove('active'); contactBtn.setAttribute('aria-expanded', 'false'); contactBtn.focus(); }
  });

  contactToolbar.addEventListener('click', (ev) => { ev.stopPropagation(); });

  contactToolbar.addEventListener('keydown', (ev) => {
    if (ev.key === 'Escape') { contactToolbar.classList.remove('active'); contactBtn.setAttribute('aria-expanded', 'false'); contactBtn.focus(); }
  });

  document.addEventListener('click', (ev) => {
    if (!contactToolbar.contains(ev.target) && ev.target !== contactBtn) {
      if (contactToolbar.classList.contains('active')) {
        contactToolbar.classList.remove('active');
        contactBtn.setAttribute('aria-expanded', 'false');
      }
    }
  }, { passive: true });
}

        function wireFab() {
          const el = q('#cartFab') || q('.fab');
          if (!el) return;
          el.addEventListener('click', () => {
            const section = DOM.serviceRequestSection;
            if (!section) return;
            const visible = !(section.style.display === 'none' || getComputedStyle(section).display === 'none');
            if (!visible) {
              section.style.display = 'block';
              section.scrollIntoView({ behavior: 'smooth', block: 'start' });
              updateserviceRequestUI(); updateFabVisibility();
            } else toggleCartinvoice();
          }, { passive: true });
        }

        /* ---------- global wiring ---------- */
        function wireGlobal() {
          wireFab();
          qAll('.checkout-button').forEach(b => {
            b.addEventListener('click', () => {
              if (!State.serviceRequest.length) { toast('Please add at least one service before booking.'); return; }
              toggleCartinvoice();
            }, { passive: true });
          });
          qAll('.clear-all-btn').forEach(b => b.addEventListener('click', () => {
            State.serviceRequest = []; persistCartPlain(State.serviceRequest); updateserviceRequestUI(); updateFabVisibility();
          }, { passive: true }));
         // Wire all "More Services" buttons to showCategories
         qAll('.book-more-button').forEach(btn => {
          btn.addEventListener('click', () => {
            try { showCategories(); } catch (_) {}
            const grid = q('#categories-grid');
            if (grid) grid.scrollIntoView({ behavior: 'smooth', block: 'start' });
          });
        });

          const ov = ensureInvoiceOverlayExists();
          ov.addEventListener('click', e => { if (e.target === ov) { closeInvoiceDrawer(); restorePriorDisplays(); } }, { passive: true });

          // replace inline alerts with toast
          const contactCardBtn = q('#contactCardButton');
          if (contactCardBtn) contactCardBtn.addEventListener('click', (e) => { e.preventDefault(); toast('Contact card functionality to be implemented'); });

          const manageVisitBtn = q('#manageVisitBtn');
          if (manageVisitBtn) manageVisitBtn.addEventListener('click', () => { toast('Redirecting to Manage Your Visit page...'); }, { passive: true });

          // contact modal handlers (safe, defensive)
          const modal = q('#mycontactModal'), btn = q('#contactBtn'), span = document.getElementsByClassName('contactModalClose')[0];
          try { wireContactToolbar(); } catch (err) { console.error('wireContactToolbar', err); }
          if (span && modal) span.addEventListener('click', () => { modal.style.display = 'none'; }, { passive: true });
          window.addEventListener('click', (event) => { if (modal && event.target === modal) modal.style.display = 'none'; }, { passive: true });
        }

        /* ---------- cart drawer toggle (uses capture/restore) ---------- */
        function toggleCartinvoice() {
          const ov = ensureInvoiceOverlayExists();
          if (ov.classList.contains('open')) {
            closeInvoiceDrawer(); restorePriorDisplays(); return;
          }
          capturePriorDisplays();
          if (DOM.categoriesGrid) DOM.categoriesGrid.style.display = 'none';
          if (DOM.serviceRequestContainer) DOM.serviceRequestContainer.style.display = 'none';
          if (DOM.servicedetailsContainer) DOM.servicedetailsContainer.style.display = 'none';
          if (DOM.serviceRequestSection) DOM.serviceRequestSection.style.display = 'none';
          renderInvoiceDrawer(); openInvoiceDrawer();
        }

        /* ---------- initialization and guarded intervals ---------- */
        function initDomRefs() {
          DOM.categoriesGrid = q('#categories-grid'); DOM.contactBtn = q('#contactBtn'); DOM.contactToolbar = q('#contactToolbar');
          DOM.cartFab = q('#cartFab'); DOM.fabCount = q('#fabCartCount'); DOM.invoiceOverlay = q('#invoiceOverlay'); DOM.invoiceServiceList = q('#invoiceServiceList');
          DOM.invoiceTotal = q('#invoiceTotal'); DOM.serviceCount = q('#serviceCount'); DOM.serviceRequestList = q('#serviceRequestList');
          DOM.estimateTotal = q('#estimateTotal'); DOM.totalAmount = q('#totalAmount'); DOM.serviceRequestContainer = q('#serviceRequestContainer');
          DOM.servicedetailsContainer = q('#servicedetailsContainer'); DOM.selectedSection = q('#selectedSection'); DOM.serviceRequestSection = q('#serviceRequestSection'); DOM.scheduleCard = q('.card-schedule-service');
        }

        function init() {
          try {
            initDomRefs();
            if (DOM.serviceRequestSection) DOM.serviceRequestSection.style.display = State.serviceRequest && State.serviceRequest.length > 0 ? 'block' : 'none';
            buildCategoryTiles(); wireGlobal(); updateserviceRequestUI(); updateFabVisibility();
            // guarded persistence interval to avoid duplicates across re-inits
            if (!window.__booktom_persist_interval) {
              window.__booktom_persist_interval = setInterval(() => persistCartPlain(State.serviceRequest), 10000);
            }
            window.addEventListener('beforeunload', () => persistCartPlain(State.serviceRequest), { passive: true });

            // debounced resize handler
            if (!window.__booktom_resize_installed) {
              const onResizeHandler = debounce(() => {
                // minimal work only: set CSS vars (use CSS for layout changes)
                document.documentElement.style.setProperty('--vp-width', String(window.innerWidth));
                document.documentElement.style.setProperty('--vp-height', String(window.innerHeight));
              }, 220);
              window.addEventListener('resize', onResizeHandler, { passive: true });
              window.__booktom_resize_installed = true;
            }

            // optional element-level observer for .qrc_page_inner (safe fallback)
            if ('ResizeObserver' in window && !window.__booktom_ro_installed) {
              try {
                const el = q('.qrc_page_inner');
                if (el) {
                  const ro = new ResizeObserver(debounce(entries => {
                    for (const entry of entries) {
                      const w = entry.contentRect.width;
                      entry.target.classList.toggle('compact', w < 360);
                    }
                  }, 120));
                  ro.observe(el); window.__booktom_ro_installed = true;
                }
              } catch (_) { /* noop */ }
            }

          } catch (e) { console.error('init', e); }
        }

        if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init, { passive: true }); else init();

      })();
    }

  </script>

</body>

</html>
